version: '3.6'
services:

  rabbitmq:
    labels:
      - traefik.frontend.rule=Host:rabbitmq.hellupline.com
      - traefik.port=15672
    image: rabbitmq:3.7-management-alpine
    restart: always
    networks:
      - backend
    expose:
      - '15672'
      - '5672'

  nursequery:
    labels:
      - traefik.frontend.rule=Host:query.hellupline.com
    image: hellupline/nursequery
    build:
      dockerfile: Dockerfile
      context: ./nursequery/
    restart: always
    networks:
      - frontend
      - backend
    expose:
      - '8080'
    depends_on:
      - nursefetch

  nursebadge:
    labels:
      - traefik.frontend.rule=Host:www.hellupline.com
    image: hellupline/nursebadge
    build:
      dockerfile: Dockerfile
      context: ./nursebadge/
    restart: always
    networks:
      - frontend
    expose:
      - '8080'
    depends_on:
      - nursequery

  nursefetch:
    labels:
      - traefik.enable=false
    image: hellupline/nursefetch
    build:
      dockerfile: Dockerfile
      context: ./nursefetch/
    restart: always
    networks:
      - backend
    depends_on:
      - rabbitmq

networks:
  frontend:
  backend:
